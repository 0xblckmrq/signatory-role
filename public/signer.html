<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sign Message</title>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.min.js"></script>
</head>
<body>
<h2>Sign Your Bot Message</h2>

<input type="text" id="msg" size="80" readonly />
<br><br>
<button onclick="sign()">Sign Message</button>

<p id="signature"></p>

<script>
function getChallengeFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("challenge");
}

window.onload = () => {
  const challenge = getChallengeFromURL();
  if (challenge) {
    document.getElementById("msg").value = decodeURIComponent(challenge);
  }
};

async function sign() {
  const challenge = document.getElementById("msg").value;
  if (!challenge) return alert("Missing challenge!");

  let provider;

  if (window.ethereum) {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    provider = new ethers.BrowserProvider(window.ethereum);
  } else {
    const wcProvider = new WalletConnectProvider.default({
      infuraId: window.INFURA_KEY || "YOUR_INFURA_KEY"
    });
    await wcProvider.enable();
    provider = new ethers.BrowserProvider(wcProvider);
  }

  const signer = await provider.getSigner();

  try {
    const sig = await signer.signMessage(challenge);
    document.getElementById("signature").innerText = sig;
  } catch (e) {
    alert(e.message);
  }
}
</script>
</body>
</html>
